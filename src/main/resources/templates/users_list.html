<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.springframework.org/security/tags">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <th:block th:replace="frag::scripts"/>
    <title>User page</title>
</head>
<body>

<div class="container-fluid" th:fragment="admin_panel_header">
    <th:block th:replace="frag::page_header"></th:block>

    <th:block sec:authorize="hasAnyAuthority('ADMIN')">
        <div class="row">
            <div class="col-2 p-0">
                <div class="list-group">
                    <th:block th:unless="${comeback}">
                        <a class="list-group-item rounded-0 list-group-item-action border-0 active" href="/admin">Admin</a>
                        <a class="list-group-item rounded-0 list-group-item-action border-0" href="/user">User</a>
                    </th:block>
                    <th:block th:if="${comeback}">
                        <a class="list-group-item rounded-0 list-group-item-action border-0" href="/admin">Admin</a>
                        <a class="list-group-item rounded-0 list-group-item-action border-0 active" href="/user">User</a>
                    </th:block>
                </div>
            </div>

            <div class="col-10 bg-light vh-100">
                <h1 th:unless="${comeback}">Admin panel</h1>
                <h1 th:if="${comeback}">User information-page</h1>
                <nav>
                    <div class="nav nav-tabs" id="tabs">
                        <a class="nav-item nav-link active" id="tab_profile" data-toggle="tab" href="#profile_id">User table</a>
                        <a class="nav-item nav-link" id="tab_crud" data-toggle="tab" href="#crud_id" th:unless="${comeback}">New user</a>
                    </div>
                </nav>
                <div class="tab-content bg-light border" id="interface_content_id">
<!--/*                    <th:block th:replace="frag::user_list"></th:block> */-->
                    <div class="tab-pane bg-white fade show active" id="profile_id">
                        <div class="row-auto">
                            <h4 class="bg-light p-2" th:unless="${comeback}">All users</h4>
                            <h4 class="bg-light p-2" th:if="${comeback}">About user</h4>
                        </div>
                        <div class="row-auto p-4">
                            <div class="table-responsive">
                                <table class="table table-striped bg-white">
                                    <thead>
                                    <tr>
                                        <th:block th:replace="frag::users_list_headers"></th:block>
                                        <th scope="col" th:unless="${comeback}">Edit</th>
                                        <th scope="col" th:unless="${comeback}">Delete</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr th:each="user : ${users}">
                                        <th:block th:replace="frag::users_list_block"></th:block>
                                        <td th:unless="${comeback}">
                                            <button type="button" th:attr="id=${'edit_'+user.id},value=${user.id}" class="btn btn-info" data-toggle="modal" data-target="#modal_edit_id">
                                                Edit
                                            </button>
                                        </td>
                                        <td th:unless="${comeback}">
                                            <button type="button" th:attr="id=${'delete_'+user.id},value=${user.id}" class="btn btn-danger" data-toggle="modal" data-target="#modal_edit_id">
                                                Delete
                                            </button>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="crud_id" th:unless="${comeback}">
                        <div class="row-auto">
                            <h4 class="bg-light p-2">Add new user</h4>
                        </div>
                        <div class="row-auto bg-white">
                            <div class="col-4 offset-4">
                                <form class="p-4 text-center" id="new_user" action="/admin/update">
                                    <div th:replace="frag::common_parameters_block('add_first', 'add_last', 'add_age', 'add_email')"></div>
                                    <div th:replace="frag::user_parameter('password', 'add_password', 'password', 'Password', 'false')"></div>
                                    <div class="form-group">
                                        <label class="font-weight-bold m-0" for="permit_id">Role</label>
                                        <select class="custom-select" id="permit_id" name="role" multiple>
                                            <th:block th:each="permit, stat : ${permits}">
                                                <option th:id="${'permit_'+stat.index}" th:value="${permit}" th:text="${permit}">PERMIT</option>
                                            </th:block>
                                        </select>
                                    </div>
                                    <div class="col" align="center">
                                        <button type="submit" form="new_user" class="btn btn-success">Add new user</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </th:block>

    <th:block sec:authorize="!hasAnyAuthority('ADMIN')">
        <div class="row">
            <div class="col-2 p-0">
                <div class="list-group">
                    <a class="list-group-item rounded-0 list-group-item-action border-0 active" href="/user">User</a>
                </div>
            </div>
            <div class="col-10 bg-light vh-100">
                <h1 >User information-page</h1>
                <div class="tab-content bg-white border">
<!--/*                    <th:block th:replace="frag::about_user"></th:block> */-->
                    <div class="row-auto">
                        <h4 class="bg-light p-2">About user</h4>
                    </div>
                    <div class="row-auto p-4">
                        <div class="table-responsive">
                            <table class="table table-striped bg-white">
                                <thead>
                                <tr>
                                    <th:block th:replace="frag::users_list_headers"></th:block>
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="user : ${users}">
                                    <th:block th:replace="frag::users_list_block"></th:block>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </th:block>
</div>

<div class="modal fade" p-2 id="modal_edit_id" tabindex="-1" sec:authorize="hasAnyAuthority('ADMIN')">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modal_caption">Edit user</h5>
                <button type="button" class="close" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="form_edit_id" class="p-4 text-center">
                    <div th:replace="frag::edit_block('modal_id', 'modal_first', 'modal_last', 'modal_age', 'modal_email', 'modal_password')"></div>
                    <div class="form-group">
                        <label class="font-weight-bold m-0" for="modal_role_id">Role</label>
                        <select class="custom-select" id="modal_role_id" size="2" name="role" multiple>
                            <!--/* <option value="1">ADMIN</option> */-->
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="submit" id="modal_submit" formaction="/admin/update" form="form_edit_id" class="btn btn-primary">Edit</button>
            </div>
        </div>
    </div>
</div>

</body>

<th:block th:replace="admin_script::script"></th:block>

</html>

